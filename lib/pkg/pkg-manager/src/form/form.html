<!DOCTYPE html>
<html>
  <head>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/react.production.min.js"></script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/react-dom.production.min.js"></script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/material-ui.production.min.js"></script>
    <script>
      MaterialUI.default = MaterialUI;
    </script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/jsonforms-core.js"></script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/jsonforms-react.js"></script>
    <script src="https://cdn.fusebit.io/fusebit/js/fusebit-form/latest/jsonforms-material.js"></script>
  </head>

  <body>
    <div id="root"></div>
    <script type="text/babel" crossorigin>
      const { Button, createMuiTheme, ThemeProvider } = MaterialUI;
         const { useState } = React;

         function postForm(path, payload) {
         const form = document.createElement('form');
         form.method = 'post';
         form.action = path;

         const payloadField = document.createElement('input');
         payloadField.type = 'hidden';
         payloadField.name = 'payload';
         payloadField.value = JSON.stringify({payload, state: ##state##});

         form.appendChild(payloadField);

         document.body.appendChild(form);
         form.submit();
      }

      function App() {
        const renderers = JSONFormsMaterial.materialRenderers;
        const cells = JSONFormsMaterial.materialCells;

        const schema = ##schema##;
        const uischema = ##uischema##;
        const [data, setData] = useState(##data##);

        const submitForm = () => {
          const target = ##submit_url##;
          console.log(`Sending ${JSON.stringify(data)} to ${target} from ${window.location.href}`);
          postForm(target, data);
        }

        const cancelForm = () => {
          const target = ##cancel_url##;
          console.log(`Sending ${JSON.stringify(data)} to ${target} from ${window.location.href}`);
             postForm(target, {});
        }

        return (
          <div>
            <JSONFormsReact.JsonForms
              renderers={renderers}
              cells={cells}
              schema={schema}
              uischema={uischema}
              data={data}
              onChange={({ errors, data }) => setData(data)}
            />
            <br/>
            <Button variant="contained" color="primary" onClick={submitForm}>Submit</Button>
            <Button variant="contained" color="secondary" onClick={cancelForm}>Cancel</Button>
          </div>
        );
      }

      ReactDOM.render(
        <ThemeProvider theme={createMuiTheme({})}>
          <App />
        </ThemeProvider>,
        document.getElementById('root')
      );
    </script>
  </body>
</html>
