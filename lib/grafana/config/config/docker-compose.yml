version: '3'
services:
  tempo:
    image: grafana/tempo:latest
    command: ['-config.file=/etc/tempo.yaml']
    volumes:
      - /root/tempo.yml:/etc/tempo.yaml
      - /root/tempo-data:/tmp/tempo
      - /var/log/:/var/log/
    ports:
      - '3200:3200/tcp' # http
      - '4317:4317/tcp' # grpc ingest
      - '7947:7947'
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'

  loki:
    image: grafana/loki:2.3.0
    command: ['-config.file=/etc/loki/loki.yaml', '-memberlist.advertise-addr=${EXTERNAL_IP}']
    volumes:
      - /root/loki.yml:/etc/loki/loki.yaml
      - /var/log/:/var/log/
      - /root/loki:/loki/
    ports:
      - '3100:3100'
      - '7946:7946'
    environment:
      - EXTERNAL_IP=${EXTERNAL_IP}
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'

  grafana:
    image: grafana/grafana:latest
    command: ['--config=/etc/grafana/grafana.ini']
    volumes:
      - /root/grafana.ini:/etc/grafana/grafana.ini
      - /var/log/:/var/log/
    ports:
      - '3000:3000'
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'

  health:
    image: public.ecr.aws/fusebit/grafana-health:latest
    ports:
      - '9999:9999'
    logging:
      driver: 'json-file'
      options:
        max-size: '50m'
